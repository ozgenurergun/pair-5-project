@if (customer()) { @if (!isEditMode()) {
<fieldset class="bg-[#2C2A4A] border border-gray-600 rounded-lg p-6 text-white w-full">
  <legend class="px-3 text-xl font-semibold text-gray-200 bg-[#2C2A4A] flex items-center space-x-3">
    <span>Customer Info</span>
    <button
      (click)="onEdit()"
      class="text-gray-400 hover:text-white transition-colors cursor-pointer"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"
        />
      </svg>
    </button>
    <button
      (click)="onDelete()"
      class="text-gray-400 hover:text-red-500 transition-colors cursor-pointer"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.578 0c-.275-.046-.55-.08-.827-.111m12.578 0c-3.866 0-7.525.84-10.824 2.285m10.824-2.285c.378.083.757.18 1.13.29M10.34 5.79a48.068 48.068 0 0 1-3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.068 48.068 0 0 0-7.5 0"
        />
      </svg>
    </button>
  </legend>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6">
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">First Name *</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.firstName }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">Middle Name</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.middleName || '-' }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">Last Name *</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.lastName }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">Birth Date *</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.dateOfBirth }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">Gender *</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.gender }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">Father Name</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.fatherName || '-' }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">Mother Name</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.motherName || '-' }}</span>
    </div>
    <div class="flex justify-between items-baseline">
      <span class="text-sm text-gray-400">National ID *</span
      ><span class="text-base font-medium text-gray-200">{{ customer()?.nationalId }}</span>
    </div>
  </div>
</fieldset>
} @else {
<fieldset class="bg-[#2C2A4A] border border-gray-600 rounded-lg p-6 text-white w-full">
  <legend class="px-3 text-xl font-semibold text-gray-200 bg-[#2C2A4A] flex items-center space-x-3">
    <span>Customer Info</span>
    <button
      (click)="onCancelEdit()"
      class="text-gray-400 hover:text-white transition-colors cursor-pointer"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
      </svg>
    </button>
  </legend>

  <form [formGroup]="updateCustomerForm" (submit)="onSaveUpdate()" class="mt-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
      <div class="form-group">
        <label for="first-name" class="block text-sm font-medium text-gray-400 mb-1"
          >First Name *</label
        >
        <input
          formControlName="firstName"
          type="text"
          id="first-name"
          class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
          [class.border-red-500]="isFieldInvalid('firstName')"
        />
        @if (isFieldInvalid('firstName')) {
        <div class="text-red-400 mt-1 text-sm ml-4">
          @if (updateCustomerForm.get('firstName')?.hasError('required')) {
          <small>First name is required.</small> } @if
          (updateCustomerForm.get('firstName')?.hasError('minlength')) {
          <small>First name must be min 2 characters.</small> }
        </div>
        }
      </div>

      <div>
        <label for="middle-name" class="block text-sm font-medium text-gray-400 mb-1"
          >Middle Name</label
        >
        <input
          formControlName="middleName"
          type="text"
          id="middle-name"
          class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label for="last-name" class="block text-sm font-medium text-gray-400 mb-1"
          >Last Name *</label
        >
        <input
          formControlName="lastName"
          type="text"
          id="last-name"
          class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
          [class.border-red-500]="isFieldInvalid('lastName')"
        />
        @if (isFieldInvalid('lastName')) {
        <div class="text-red-400 mt-1 text-sm ml-4">
          @if (updateCustomerForm.get('lastName')?.hasError('required')) {
          <small>Last name is required.</small> }
        </div>
        }
      </div>

      <div>
        <label for="birth-date" class="block text-sm font-medium text-gray-400 mb-1"
          >Birth Date *</label
        >
        <div class="relative">
          <input
            formControlName="dateOfBirth"
            type="date"
            id="birth-date"
            class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
            [class.border-red-500]="isFieldInvalid('dateOfBirth')"
          />
        </div>
        @if (isFieldInvalid('dateOfBirth')) {
        <div class="text-red-400 mt-1 text-sm ml-4">
          @if (updateCustomerForm.get('dateOfBirth')?.hasError('required')) {
          <small>Birth date is required.</small> }
        </div>
        }
      </div>

      <div>
        <label for="gender" class="block text-sm font-medium text-gray-400 mb-1">Gender *</label>
        <div class="relative">
          <select
            id="gender"
            class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
            formControlName="gender"
            [class.border-red-500]="isFieldInvalid('gender')"
          >
            <option value="" disabled>Please choose...</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
          </select>
          <span class="absolute inset-y-0 right-0 flex items-center pr-5 pointer-events-none">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-5 h-5 text-gray-500"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
            </svg>
          </span>
        </div>
        @if (isFieldInvalid('gender')) {
        <div class="text-red-400 mt-1 text-sm ml-4">
          @if (updateCustomerForm.get('gender')?.hasError('required')) {
          <small>Please choose one option.</small> }
        </div>
        }
      </div>

      <div>
        <label for="father-name" class="block text-sm font-medium text-gray-400 mb-1"
          >Father Name</label
        >
        <input
          formControlName="fatherName"
          type="text"
          id="father-name"
          class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label for="mother-name" class="block text-sm font-medium text-gray-400 mb-1"
          >Mother Name</label
        >
        <input
          formControlName="motherName"
          type="text"
          id="mother-name"
          class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div class="form-group">
        <label for="national-id" class="block text-sm font-medium text-gray-400 mb-1"
          >National ID *</label
        >
        <input
          formControlName="nationalId"
          type="text"
          id="national-id"
          class="w-full bg-gray-200 text-gray-900 rounded-full px-5 py-3 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
          [class.border-red-500]="isFieldInvalid('nationalId')"
        />
        @if (isFieldInvalid('nationalId')) {
        <div class="text-red-400 mt-1 text-sm ml-4">
          @if (updateCustomerForm.get('nationalId')?.hasError('required')) {
          <small>National ID is required.</small> } @if
          (updateCustomerForm.get('nationalId')?.hasError('minlength') ||
          updateCustomerForm.get('nationalId')?.hasError('maxlength')) {
          <small>National ID must be 11 characters.</small> } @if
          (updateCustomerForm.get('nationalId')?.hasError('pattern')) {
          <small>Please enter valid National ID.</small> }
        </div>
        }
      </div>
    </div>

    <div class="flex items-center justify-center space-x-6 mt-12">
      <button
        type="button"
        (click)="onCancelEdit()"
        class="bg-gray-200 text-gray-900 font-bold py-3 px-10 rounded-full hover:bg-gray-300 transition-colors text-lg cursor-pointer"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="bg-gray-200 text-gray-900 font-bold py-3 px-10 rounded-full hover:bg-gray-300 transition-colors text-lg cursor-pointer"
      >
        Save
      </button>
    </div>
  </form>
</fieldset>
} } @else {
<div class="text-center text-gray-400">Customer data loading...</div>
} @if (isErrorModalVisible()) {
<app-popup
  title="Error"
  [message]="errorModalMessage()"
  confirmText="OK"
  cancelText=""
  (onConfirm)="closeErrorModal()"
></app-popup>
} @if (isDeleteConfirmVisible()) {
<app-popup
  title="Confirm Deletion"
  message="Are you sure you want to delete this customer? This action cannot be undone."
  confirmText="Yes, Delete"
  cancelText="Cancel"
  (onConfirm)="confirmDelete()"
  (onCancel)="onCancelDelete()"
></app-popup>
}
