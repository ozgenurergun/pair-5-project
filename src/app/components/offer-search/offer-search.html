<fieldset class="border border-gray-500 rounded-lg p-6 h-full">
  <legend class="px-3 text-2xl font-semibold text-gray-300 bg-[#2C2A4A]">Offer Selection</legend>

  <div class="flex border-b border-gray-600 mb-6">
    <button
      (click)="setTab('catalog')"
      [class.text-white]="activeTab() === 'catalog'"
      [class.border-white]="activeTab() === 'catalog'"
      [class.text-gray-500]="activeTab() !== 'catalog'"
      [class.border-transparent]="activeTab() !== 'catalog'"
      class="py-2 px-6 font-semibold border-b-2"
    >
      Catalog
    </button>
    <button
      (click)="setTab('campaign')"
      [class.text-white]="activeTab() === 'campaign'"
      [class.border-white]="activeTab() === 'campaign'"
      [class.text-gray-500]="activeTab() !== 'campaign'"
      [class.border-transparent]="activeTab() !== 'campaign'"
      class="py-2 px-6 font-semibold border-b-2"
    >
      Campaign
    </button>
  </div>

  <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
    @if (activeTab() === 'catalog') {
    <div class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-1">Catalog Selection</label>
          <select
            formControlName="catalogSelection"
            class="w-full bg-gray-200 text-gray-900 rounded-lg px-4 py-2.5"
          >
            <option value="">Select Catalog...</option>
            @for (catalog of catalogs(); track catalog.id) {
            <option [value]="catalog.id">{{ catalog.name }}</option>
            }
          </select>
        </div>
      </div>
      <div class="grid grid-cols-3 gap-4 items-end">
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-1">Prod Offer ID</label>
          <input
            type="number"
            formControlName="catalogOfferId"
            class="w-full bg-gray-200 text-gray-900 rounded-lg px-4 py-2.5 disabled:opacity-50 disabled:cursor-not-allowed"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-1">Prod Offer Name</label>
          <input
            type="text"
            formControlName="catalogOfferName"
            class="w-full bg-gray-200 text-gray-900 rounded-lg px-4 py-2.5 disabled:opacity-50 disabled:cursor-not-allowed"
          />
        </div>
        <button
          type="submit"
          [disabled]="checkSearchDisabled()"
          class="bg-gray-200 text-gray-900 font-bold py-2.5 px-6 rounded-lg hover:bg-gray-300 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Search
        </button>
      </div>
    </div>
    } @if (activeTab() === 'campaign') {
    <div class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-1">Campaign Selection</label>
          <select
            formControlName="campaignSelection"
            class="w-full bg-gray-200 text-gray-900 rounded-lg px-4 py-2.5"
          >
            <option value="">Select Campaign...</option>
            @for (campaign of campaigns(); track campaign.id) {
            <option [value]="campaign.id">{{ campaign.name }}</option>
            }
          </select>
        </div>
      </div>
      <div class="grid grid-cols-3 gap-4 items-end">
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-1">Prod Offer ID</label>
          <input
            type="number"
            formControlName="campaignOfferId"
            class="w-full bg-gray-200 text-gray-900 rounded-lg px-4 py-2.5 disabled:opacity-50 disabled:cursor-not-allowed"
            placeholder=""
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-1">Prod Offer Name</label>
          <input
            type="text"
            formControlName="campaignName"
            class="w-full bg-gray-200 text-gray-900 rounded-lg px-4 py-2.5 disabled:opacity-50 disabled:cursor-not-allowed"
          />
        </div>
        <button
          type="submit"
          [disabled]="checkSearchDisabled()"
          class="bg-gray-200 text-gray-900 font-bold py-2.5 px-6 rounded-lg hover:bg-gray-300 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Search
        </button>
      </div>
    </div>
    }
  </form>

  <div class="mt-8">
    <div class="overflow-x-auto max-h-[400px] rounded-lg border border-gray-700">
      <table class="w-full min-w-max text-left text-sm text-gray-300">
        <thead class="bg-[#4A476B] text-xs uppercase text-gray-300 sticky top-0">
          <tr>
            @if (activeTab() === 'catalog') {
            <th scope="col" class="px-4 py-3">Product Offer ID</th>
            <th scope="col" class="px-4 py-3">Product Offer Name</th>
            <th scope="col" class="px-4 py-3">Price</th>
            } @else {
            <th scope="col" class="px-4 py-3">Campaign ID</th>
            <th scope="col" class="px-4 py-3">Product Offer ID</th>
            <th scope="col" class="px-4 py-3">Product Offer Name</th>
            <th scope="col" class="px-4 py-3">Price</th>
            }
            <th scope="col" class="px-4 py-3 text-center">Add</th>
          </tr>
        </thead>
        <tbody>
          @for (offer of searchResults(); track offer.id) {
          <tr class="border-b border-gray-700 hover:bg-[#403E61] transition-colors">
            @if (activeTab() === 'campaign') {
            <td class="px-4 py-3">
              <span>{{ currentCampaignId }}</span>
            </td>
            }

            <td class="px-4 py-3">{{ offer.id }}</td>
            <td class="px-4 py-3 md:max-w-[200px] truncate">{{ offer.name }}</td>
            <td class="px-4 py-3">
              @if (offer.discountedPrice != offer.price) {
              <span class="line-through text-gray-500 text-xs">{{
                offer.price | currency : 'TRY '
              }}</span>
              <span class="ml-1">{{ offer.discountedPrice | currency : 'TRY ' }}</span>
              } @else {
              <span>{{ offer.price | currency : 'TRY ' }}</span>
              }
            </td>
            <td class="px-4 py-3 text-center">
              <button
                (click)="addToBasket(offer)"
                class="text-gray-400 hover:text-white cursor-pointer"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-cart"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"
                  />
                </svg>
              </button>
            </td>
          </tr>
          } @empty {
          <tr class="border-b border-gray-700">
            <td
              [attr.colspan]="activeTab() === 'catalog' ? 4 : 5"
              class="text-center py-4 text-gray-500"
            >
              No results found.
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</fieldset>
